<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>3D游戏编程作业4-打飞碟 - Adbean&#39;s Blog</title><meta name="Description" content="Adbean&#39;s Blog"><meta property="og:title" content="3D游戏编程作业4-打飞碟" />
<meta property="og:description" content="与游戏世界交互 &amp;&amp; 物理系统与碰撞 编写一个简单的鼠标打飞碟（Hit UFO）游戏 游戏内容要求： 游戏有 n 个 round，每个 round 都包括10 次 trial；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://ad-bean.github.io/posts/my-fourth-unity/" /><meta property="og:image" content="http://ad-bean.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-27T09:22:46+08:00" />
<meta property="article:modified_time" content="2021-10-27T09:22:46+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://ad-bean.github.io/logo.png"/>

<meta name="twitter:title" content="3D游戏编程作业4-打飞碟"/>
<meta name="twitter:description" content="与游戏世界交互 &amp;&amp; 物理系统与碰撞 编写一个简单的鼠标打飞碟（Hit UFO）游戏 游戏内容要求： 游戏有 n 个 round，每个 round 都包括10 次 trial；"/>
<meta name="application-name" content="Adbean&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Adbean&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/Owl.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://ad-bean.github.io/posts/my-fourth-unity/" /><link rel="prev" href="http://ad-bean.github.io/posts/my-third-unity/" /><link rel="next" href="http://ad-bean.github.io/posts/my-sixth-unity/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "3D游戏编程作业4-打飞碟",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/ad-bean.github.io\/posts\/my-fourth-unity\/"
        },"genre": "posts","keywords": "3D游戏编程, 作业","wordcount":  2856 ,
        "url": "http:\/\/ad-bean.github.io\/posts\/my-fourth-unity\/","datePublished": "2021-10-27T09:22:46+08:00","dateModified": "2021-10-27T09:22:46+08:00","publisher": {
            "@type": "Organization",
            "name": "Adbean"},"author": {
                "@type": "Person",
                "name": "Adbean"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Adbean&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/Owl.ico"
        data-srcset="/Owl.ico, /Owl.ico 1.5x, /Owl.ico 2x"
        data-sizes="auto"
        alt="/Owl.ico"
        title="/Owl.ico" />Adbean&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> 主页 </a><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/posts/my-index/"> 索引 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Adbean&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/Owl.ico"
        data-srcset="/Owl.ico, /Owl.ico 1.5x, /Owl.ico 2x"
        data-sizes="auto"
        alt="/Owl.ico"
        title="/Owl.ico" />Adbean&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">主页</a><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/posts/my-index/" title="">索引</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">3D游戏编程作业4-打飞碟</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://adbean.gitee.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Adbean</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E4%BD%9C%E4%B8%9A/"><i class="far fa-folder fa-fw"></i>作业</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-10-27">2021-10-27</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2856 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#与游戏世界交互--物理系统与碰撞">与游戏世界交互 &amp;&amp; 物理系统与碰撞</a></li>
    <li><a href="#项目代码与项目视频演示">项目代码与项目视频演示</a></li>
    <li><a href="#项目文档">项目文档</a>
      <ul>
        <li><a href="#项目配置过程">项目配置过程</a></li>
        <li><a href="#游戏规则">游戏规则</a></li>
        <li><a href="#工厂模式adapter-mvc">工厂模式、Adapter、 MVC</a></li>
        <li><a href="#带缓存的工厂模式">带缓存的工厂模式</a></li>
        <li><a href="#实体">实体</a></li>
        <li><a href="#控制器">控制器</a></li>
        <li><a href="#裁判">裁判</a></li>
        <li><a href="#适配器">适配器</a></li>
        <li><a href="#运行效果">运行效果</a></li>
        <li><a href="#项目心得">项目心得：</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="与游戏世界交互--物理系统与碰撞">与游戏世界交互 &amp;&amp; 物理系统与碰撞</h2>
<blockquote>
<p>编写一个简单的鼠标打飞碟（Hit UFO）游戏</p>
<ul>
<li>游戏内容要求：</li>
</ul>
<ol>
<li>游戏有 n 个 round，每个 round 都包括10 次 trial；</li>
<li>每个 trial 的飞碟的色彩、大小、发射位置、速度、角度、同时出现的个数都可能不&gt; 同。它们由该 round 的 ruler 控制；</li>
<li>每个 trial 的飞碟有<strong>随机性</strong>，总体难度随 round 上升；</li>
<li>鼠标点中得分，得分规则按色彩、大小、速度不同计算，规则可自由设定。</li>
</ol>
<ul>
<li>游戏的要求：
<ul>
<li>使用<strong>带缓存的工厂模式</strong>管理不同飞碟的生产与回收，该工厂必须是场景<strong>单实例</strong>的！具体实现见参考资源 <code>Singleton</code> 模板类</li>
<li>近可能使用前面 <code>MVC</code> 结构实现人机交互与游戏模型分离</li>
</ul>
</li>
<li>改进飞碟（Hit UFO）游戏：
<ul>
<li>游戏内容要求：
<ol>
<li>按 <em>adapter模式</em> 设计图修改飞碟游戏</li>
<li>使它同时支持物理运动与运动学（变换）运动</li>
</ol>
</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="项目代码与项目视频演示">项目代码与项目视频演示</h2>
<blockquote>
<p>博客地址：<a href="https://ad-bean.github.io/" target="_blank" rel="noopener noreffer">Github 博客</a></p>
<p>项目地址：<a href="https://gitee.com/adbean/Unity-3DGameProgramming" target="_blank" rel="noopener noreffer">Gitee 博客</a></p>
<p>作业4：Hit UFO 打飞碟：<a href="https://www.bilibili.com/video/BV1bF411e76i/" target="_blank" rel="noopener noreffer">哔哩哔哩_bilibili</a></p>
</blockquote>
<h2 id="项目文档">项目文档</h2>
<h3 id="项目配置过程">项目配置过程</h3>
<p>将 <code>Assets</code> 文件夹下的文件全拖入新建项目后，点击新导入的 <code>Scene/</code> 中的 <code>Hit UFO</code> 场景，开始游戏后即可打开项目。</p>
<h3 id="游戏规则">游戏规则</h3>
<ul>
<li>按下 <code>Space</code> 空格键发射飞碟，按下鼠标左键点击飞碟。</li>
<li>在飞碟消失前，点击飞碟得分，飞碟消失则扣分，不同难度不同颜色的飞碟分数不同。</li>
<li>游戏共有 10 个 Round ，每个 Round 共有 10 次 Trial ，游戏难度随 Round 增加。</li>
<li><strong>游戏胜利</strong>的条件为：玩家在完成 10 个 Round （即 100 次 Trial）后，其分数非负。其余所有的情况都视为**游戏失败*</li>
</ul>
<h3 id="工厂模式adapter-mvc">工厂模式、Adapter、 MVC</h3>
<p>本次项目依然按照 <code>MVC</code> 框架实现，并且根据工厂模式、适配器模式进行面向对象设计。</p>
<h4 id="model">Model</h4>
<ul>
<li><code>GameModel</code> ：裁判类，管理游戏关卡和判断游戏胜负。</li>
<li><code>UFOModel</code> ：飞碟实体，初始化飞碟的属性、速度，提供设置函数。</li>
</ul>
<h4 id="view">View</h4>
<ul>
<li><code>GameGUI</code> ：显示轮次、得分、游戏操作按钮，展示游戏画面。</li>
</ul>
<h4 id="controller">Controller</h4>
<ul>
<li><code>Ruler</code> ：判断游戏状态，控制飞碟的各种特性（位置、方向、得分、大小）。</li>
<li><code>Director</code> ：导演类，控制场景切换。</li>
<li><code>GameController</code> ：场景控制类，控制游戏场景。</li>
<li><code>UFOFactory</code> ：带有缓存的飞碟<strong>工厂</strong>，负责创建、生成飞碟对象。</li>
<li><code>Interface</code>：<strong>适配器模式</strong>的接口，用于重载 <code>SetAction</code> 方法，设置游戏对象的运动学模型。</li>
<li><code>PhysicActionManager</code>：对物体添加重力和施加 Impulse，实现动力学模型。</li>
<li><code>CCActionManager</code>：使用刚体实现运动学转换运动模型。</li>
</ul>
<h4 id="editors">Editors</h4>
<ul>
<li><code>UFOEditor</code> ：<code>UFO</code> 游戏对象的编辑器（如果摄像机位置不同，可以通过更改脚本属性来设置飞碟的初始位置）</li>
</ul>
<h3 id="带缓存的工厂模式">带缓存的工厂模式</h3>
<p>对象的新建和销毁在游戏中的开销是巨大的，一个游戏中有众多的对象，我们应该使用<strong>对象池</strong>，带缓存的工厂模式，降低对象的新建和销毁开销。在本次项目中，我使用了<strong>带缓存的工厂模式</strong>管理不同飞碟的生产和回收，且该工厂是场景单实例的：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">UFOFactory</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">enum</span> <span class="n">Color</span> <span class="p">{</span> <span class="n">Red</span><span class="p">,</span> <span class="n">Green</span><span class="p">,</span> <span class="n">Blue</span><span class="p">,</span> <span class="n">Yellow</span><span class="p">,</span> <span class="n">Purple</span> <span class="p">}</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">UFOFactory</span> <span class="n">factory</span><span class="p">;</span> <span class="c1">// 单例
</span><span class="c1"></span>	<span class="c1">// 正在使用的飞碟
</span><span class="c1"></span>    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">occupied</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;();</span> 
	<span class="c1">// 未被使用的飞碟
</span><span class="c1"></span>    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">released</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;();</span> 
    
    <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="n">invisible</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="p">-</span><span class="m">10</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>   

    <span class="c1">// 单例
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">static</span> <span class="n">UFOFactory</span> <span class="n">GetInstance</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">factory</span> <span class="p">??</span> <span class="p">(</span><span class="n">factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">UFOFactory</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="c1">// 获取特定颜色的飞碟
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">Get</span><span class="p">(</span><span class="n">Color</span> <span class="n">color</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">GameObject</span> <span class="n">ufo</span><span class="p">;</span>
      <span class="c1">// 决定是否生产
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="n">released</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">ufo</span> <span class="p">=</span> <span class="n">Object</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;(</span><span class="s">&#34;Prefabs/UFO&#34;</span><span class="p">),</span> <span class="n">invisible</span><span class="p">,</span> <span class="n">Quaternion</span><span class="p">.</span><span class="n">identity</span><span class="p">);</span>
        <span class="n">ufo</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">ufo</span> <span class="p">=</span> <span class="n">released</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="n">released</span><span class="p">.</span><span class="n">RemoveAt</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// 设置颜色
</span><span class="c1"></span>      <span class="n">Material</span> <span class="n">material</span> <span class="p">=</span> <span class="n">Object</span><span class="p">.</span><span class="n">Instantiate</span><span class="p">(</span><span class="n">Resources</span><span class="p">.</span><span class="n">Load</span><span class="p">&lt;</span><span class="n">Material</span><span class="p">&gt;(</span><span class="s">&#34;Materials/&#34;</span> <span class="p">+</span> <span class="n">color</span><span class="p">.</span><span class="n">ToString</span><span class="p">(</span><span class="s">&#34;G&#34;</span><span class="p">)));</span>
      <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">MeshRenderer</span><span class="p">&gt;().</span><span class="n">material</span> <span class="p">=</span> <span class="n">material</span><span class="p">;</span>

      <span class="n">occupied</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>
      <span class="k">return</span> <span class="n">ufo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 回收飞碟对象
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">void</span> <span class="n">Put</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">ufo</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">var</span> <span class="n">rigidbody</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>

      <span class="n">rigidbody</span><span class="p">.</span><span class="n">velocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
      <span class="n">rigidbody</span><span class="p">.</span><span class="n">angularVelocity</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">zero</span><span class="p">;</span>
      <span class="n">rigidbody</span><span class="p">.</span><span class="n">useGravity</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
      <span class="n">ufo</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">invisible</span><span class="p">;</span>

      <span class="n">occupied</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>
      <span class="n">released</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>	
</code></pre></div><p>在  <code>UFOFactory</code>  工厂模式中，使用两个列表来分别维护<strong>正在使用</strong>和<strong>未被使用</strong>的飞碟对象。使用  <code>GetInstance</code>  静态方法实现单例模式，使用  <code>Get</code>  获取特定颜色的飞碟对象和使用 <code>Put</code> 回收飞碟对象。</p>
<h3 id="实体">实体</h3>
<p><code>UFO</code> 实体 <code>UFOModel</code> 继承于  <code>MonoBehaviour</code>  类，管理飞碟对象的<strong>初始位置</strong>、<strong>初始速度</strong>和<strong>缩放比例</strong>，其具体内容如下。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">UFOModel</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">score</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="n">startPosition</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">4</span><span class="p">,</span> <span class="p">-</span><span class="m">2</span><span class="p">,</span> <span class="p">-</span><span class="m">10</span><span class="p">);</span> 
    <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="n">startSpeed</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">0.5f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">,</span> <span class="m">1.0f</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">Vector3</span> <span class="n">localScale</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Vector3</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0.05f</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>    
    
    <span class="k">private</span> <span class="kt">int</span> <span class="n">leftOrRight</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">float</span> <span class="n">speedScale</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> 
    <span class="k">private</span> <span class="kt">int</span> <span class="n">id</span><span class="p">;</span> 

    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">GetSpeed</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">Vector3</span> <span class="n">velocity</span> <span class="p">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">speedScale</span><span class="p">)</span> <span class="p">*</span> <span class="n">startSpeed</span><span class="p">;</span>
      <span class="n">velocity</span><span class="p">.</span><span class="n">x</span> <span class="p">*=</span> <span class="n">leftOrRight</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">velocity</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">GetId</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">SetSpeedScale</span><span class="p">(</span><span class="kt">float</span> <span class="n">scale</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">speedScale</span> <span class="p">=</span> <span class="n">scale</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">SetSide</span><span class="p">(</span><span class="kt">int</span> <span class="n">side</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Vector3</span> <span class="n">location</span> <span class="p">=</span> <span class="n">startPosition</span><span class="p">;</span>
      <span class="n">location</span><span class="p">.</span><span class="n">x</span> <span class="p">*=</span> <span class="n">side</span><span class="p">;</span>
      <span class="n">location</span><span class="p">.</span><span class="n">y</span> <span class="p">+=</span> <span class="n">GetId</span><span class="p">()</span> <span class="p">*</span> <span class="m">0.1f</span><span class="p">;</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">location</span><span class="p">;</span>
      <span class="n">leftOrRight</span> <span class="p">=</span> <span class="n">side</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">SetLocalScale</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Vector3</span> <span class="n">scale</span> <span class="p">=</span> <span class="n">localScale</span><span class="p">;</span>
      <span class="n">scale</span><span class="p">.</span><span class="n">x</span> <span class="p">*=</span> <span class="n">x</span><span class="p">;</span>
      <span class="n">scale</span><span class="p">.</span><span class="n">y</span> <span class="p">*=</span> <span class="n">y</span><span class="p">;</span>
      <span class="n">scale</span><span class="p">.</span><span class="n">z</span> <span class="p">*=</span> <span class="n">z</span><span class="p">;</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">localScale</span> <span class="p">=</span> <span class="n">scale</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">SetLocation</span><span class="p">(</span><span class="kt">float</span> <span class="n">x</span><span class="p">,</span> <span class="kt">float</span> <span class="n">y</span><span class="p">,</span> <span class="kt">float</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">startPosition</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">x</span><span class="p">;</span>
      <span class="n">startPosition</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="n">y</span><span class="p">;</span>
      <span class="n">startPosition</span><span class="p">.</span><span class="n">z</span> <span class="p">=</span> <span class="n">z</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">SetId</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">id</span> <span class="p">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div><h3 id="控制器">控制器</h3>
<p>在场景控制器 <code>GameController</code> 的 <code>Update</code> 函数中，监听用户输入，如鼠标左键或空格键，并且做出相应的动作，触发击中飞碟或生成飞碟等等：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp">    <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="kt">var</span> <span class="n">invisibleUFOs</span> <span class="p">=</span> <span class="n">UFOs</span><span class="p">.</span><span class="n">FindAll</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">&lt;=</span> <span class="p">-</span><span class="m">10f</span> <span class="p">||</span> <span class="n">x</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;=</span> <span class="m">10f</span><span class="p">));</span> 
      <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ufo</span> <span class="k">in</span> <span class="n">invisibleUFOs</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">OnMissUFO</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">game</span> <span class="p">==</span> <span class="n">GameState</span><span class="p">.</span><span class="n">Gamming</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">scene</span> <span class="p">==</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Shooting</span> <span class="p">&amp;&amp;</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetButtonDown</span><span class="p">(</span><span class="s">&#34;Fire1&#34;</span><span class="p">))</span> <span class="p">{</span>
          <span class="c1">// 光标拾取单个游戏对象
</span><span class="c1"></span>          <span class="n">Ray</span> <span class="n">ray</span> <span class="p">=</span> <span class="n">Camera</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">ScreenPointToRay</span><span class="p">(</span><span class="n">Input</span><span class="p">.</span><span class="n">mousePosition</span><span class="p">);</span><span class="c1">// 构建射线
</span><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="n">Physics</span><span class="p">.</span><span class="n">Raycast</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span> <span class="k">out</span> <span class="n">RaycastHit</span> <span class="n">hit</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">hit</span><span class="p">.</span><span class="n">collider</span><span class="p">.</span><span class="n">gameObject</span><span class="p">.</span><span class="n">tag</span> <span class="p">==</span> <span class="s">&#34;UFO&#34;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">OnHitUFO</span><span class="p">(</span><span class="n">hit</span><span class="p">.</span><span class="n">collider</span><span class="p">.</span><span class="n">gameObject</span><span class="p">);</span>   <span class="c1">// 点击飞碟
</span><span class="c1"></span>          <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 发射飞碟
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">scene</span> <span class="p">==</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Waiting</span> <span class="p">&amp;&amp;</span> <span class="n">Input</span><span class="p">.</span><span class="n">GetKeyDown</span><span class="p">(</span><span class="s">&#34;space&#34;</span><span class="p">))</span> <span class="p">{</span>
          <span class="n">model</span><span class="p">.</span><span class="n">scene</span> <span class="p">=</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Shooting</span><span class="p">;</span>
          <span class="n">model</span><span class="p">.</span><span class="n">NextTrial</span><span class="p">();</span>
          <span class="c1">// 若玩家满足胜利条件，按下空格不发射飞碟
</span><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">game</span> <span class="p">==</span> <span class="n">GameState</span><span class="p">.</span><span class="n">Win</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="n">UFOs</span><span class="p">.</span><span class="n">AddRange</span><span class="p">(</span><span class="n">ruler</span><span class="p">.</span><span class="n">GetUFOs</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">UFOs</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">model</span><span class="p">.</span><span class="n">scene</span> <span class="p">=</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Waiting</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div><p>由于 <code>GameController</code> 源码较长，只展示其中 <code>update()</code> 部分。</p>
<p>通过控制器沟通不同的场景，但还需要实现 <code>Ruler</code> 类来进行飞碟的发射和调用工厂模式：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Ruler</span> <span class="p">{</span>
  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">currentRound</span><span class="p">;</span>
  <span class="k">private</span> <span class="n">System</span><span class="p">.</span><span class="n">Random</span> <span class="n">random</span><span class="p">;</span> 
  <span class="k">private</span> <span class="k">static</span> <span class="n">Array</span> <span class="n">colors</span> <span class="p">=</span> <span class="n">Enum</span><span class="p">.</span><span class="n">GetValues</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">UFOFactory</span><span class="p">.</span><span class="n">Color</span><span class="p">));</span>
  <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span><span class="p">[]</span> <span class="n">UFOCount</span> <span class="p">=</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">7</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">9</span><span class="p">,</span> <span class="m">10</span> <span class="p">};</span> <span class="c1">// 数量池子
</span><span class="c1"></span>  <span class="k">private</span> <span class="k">static</span> <span class="kt">int</span><span class="p">[]</span>   <span class="n">score</span> <span class="p">=</span> <span class="p">{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span> <span class="p">};</span> <span class="c1">// 不同颜色对应不同分数，速度，大小
</span><span class="c1"></span>  <span class="k">private</span> <span class="k">static</span> <span class="kt">float</span><span class="p">[]</span> <span class="n">speed</span> <span class="p">=</span> <span class="p">{</span> <span class="m">0.2f</span><span class="p">,</span> <span class="m">0.4f</span><span class="p">,</span> <span class="m">0.6f</span><span class="p">,</span> <span class="m">0.8f</span><span class="p">,</span> <span class="m">1.0f</span> <span class="p">};</span>
  <span class="k">private</span> <span class="k">static</span> <span class="kt">float</span><span class="p">[]</span> <span class="n">scale</span> <span class="p">=</span> <span class="p">{</span> <span class="m">1.8f</span><span class="p">,</span> <span class="m">1.4f</span><span class="p">,</span> <span class="m">1f</span><span class="p">,</span> <span class="m">0.8f</span><span class="p">,</span> <span class="m">0.6f</span> <span class="p">};</span> 
  <span class="k">private</span> <span class="n">IActionManager</span> <span class="n">actionManager</span><span class="p">;</span> <span class="c1">// 运动学模型
</span><span class="c1"></span>  <span class="k">public</span> <span class="n">Ruler</span><span class="p">(</span><span class="kt">int</span> <span class="n">currentRound</span><span class="p">,</span> <span class="n">IActionManager</span> <span class="n">actionManager</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">currentRound</span> <span class="p">=</span> <span class="n">currentRound</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="n">random</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Random</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="n">actionManager</span> <span class="p">=</span> <span class="n">actionManager</span><span class="p">;</span> <span class="c1">// 设置运动学模型
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">GetUFOCount</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">UFOCount</span><span class="p">[</span><span class="n">currentRound</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">GetUFOs</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;</span> <span class="n">ufos</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">GameObject</span><span class="p">&gt;();</span>
   
    <span class="kt">var</span> <span class="n">index</span> <span class="p">=</span> <span class="n">random</span><span class="p">.</span><span class="n">Next</span><span class="p">(</span><span class="n">colors</span><span class="p">.</span><span class="n">Length</span><span class="p">);</span>               <span class="c1">//
</span><span class="c1"></span>    <span class="kt">var</span> <span class="n">color</span> <span class="p">=</span> <span class="p">(</span><span class="n">UFOFactory</span><span class="p">.</span><span class="n">Color</span><span class="p">)</span><span class="n">colors</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">index</span><span class="p">);</span> <span class="c1">// 随机生成颜色
</span><span class="c1"></span>    <span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="n">GetUFOCount</span><span class="p">();</span>                            <span class="c1">// 当前 Round 下飞碟产生数
</span><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="p">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">var</span> <span class="n">ufo</span> <span class="p">=</span> <span class="n">UFOFactory</span><span class="p">.</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Get</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>      <span class="c1">// 调用工厂方法，获取特定颜色的飞碟对象
</span><span class="c1"></span>      <span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>           <span class="c1">// 
</span><span class="c1"></span>      <span class="n">model</span><span class="p">.</span><span class="n">score</span> <span class="p">=</span> <span class="n">score</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="p">*</span> <span class="p">(</span><span class="n">currentRound</span> <span class="p">+</span> <span class="m">1</span><span class="p">);</span>    <span class="c1">// 设置飞碟对象的分数
</span><span class="c1"></span>      <span class="n">model</span><span class="p">.</span><span class="n">SetLocalScale</span><span class="p">(</span><span class="n">scale</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="m">1</span><span class="p">,</span> <span class="n">scale</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span> <span class="c1">// 设置大小
</span><span class="c1"></span>      <span class="kt">int</span> <span class="n">leftOrRight</span> <span class="p">=</span> <span class="p">((</span><span class="n">random</span><span class="p">.</span><span class="n">Next</span><span class="p">()</span> <span class="p">%</span> <span class="m">2</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">);</span> <span class="c1">//
</span><span class="c1"></span>      <span class="n">model</span><span class="p">.</span><span class="n">SetSide</span><span class="p">(</span><span class="n">leftOrRight</span><span class="p">);</span>                         <span class="c1">// 设置初始位置
</span><span class="c1"></span>      <span class="n">model</span><span class="p">.</span><span class="n">SetSpeedScale</span><span class="p">(</span><span class="n">speed</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>                  <span class="c1">// 设置速度比例
</span><span class="c1"></span>      <span class="n">model</span><span class="p">.</span><span class="n">SetId</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>                                     <span class="c1">// 设置 id
</span><span class="c1"></span>      <span class="n">actionManager</span><span class="p">.</span><span class="n">SetAction</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>                       <span class="c1">// 设置运动学模型
</span><span class="c1"></span>      <span class="n">ufos</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ufo</span><span class="p">);</span>                                      <span class="c1">// 添加到队列中
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">return</span> <span class="n">ufos</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="裁判">裁判</h3>
<p>实现 <code>GameModel</code> 来实现游戏的裁判，判断游戏进行的状态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">enum</span> <span class="n">GameState</span> <span class="p">{</span> <span class="n">Gamming</span><span class="p">,</span> <span class="n">Lose</span><span class="p">,</span> <span class="n">Win</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">enum</span> <span class="n">SceneState</span> <span class="p">{</span> <span class="n">Waiting</span><span class="p">,</span> <span class="n">Shooting</span> <span class="p">}</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GameModel</span> <span class="p">{</span>
  <span class="k">public</span> <span class="n">GameState</span> <span class="n">game</span> <span class="p">=</span> <span class="n">GameState</span><span class="p">.</span><span class="n">Gamming</span><span class="p">;</span> <span class="c1">// 当前游戏状态
</span><span class="c1"></span>  <span class="k">public</span> <span class="n">SceneState</span> <span class="n">scene</span> <span class="p">=</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Waiting</span><span class="p">;</span> <span class="c1">// 当前场景状态 
</span><span class="c1"></span>  <span class="k">public</span> <span class="n">EventHandler</span> <span class="n">onRefresh</span><span class="p">;</span> <span class="c1">// 场景控制器更新游戏画面
</span><span class="c1"></span>  <span class="k">public</span> <span class="n">EventHandler</span> <span class="n">onEnterNextRound</span><span class="p">;</span> <span class="c1">// 场景控制器更新 Ruler
</span><span class="c1"></span>  <span class="k">public</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">maxRound</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>  <span class="c1">// 最大 Round 数
</span><span class="c1"></span>  <span class="k">public</span> <span class="k">readonly</span> <span class="kt">int</span> <span class="n">maxTrial</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>  <span class="c1">// 最大 Trial 数
</span><span class="c1"></span>  <span class="k">public</span> <span class="kt">int</span> <span class="n">currentRound</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 当前 Round
</span><span class="c1"></span>  <span class="k">public</span> <span class="kt">int</span> <span class="n">currentTrial</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 当前 Trial
</span><span class="c1"></span>  <span class="k">public</span> <span class="kt">int</span> <span class="n">score</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">private</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 当前分数
</span><span class="c1"></span>  <span class="k">public</span> <span class="k">void</span> <span class="n">Reset</span><span class="p">(</span><span class="n">GameState</span> <span class="m">_</span><span class="n">game</span> <span class="p">=</span> <span class="n">GameState</span><span class="p">.</span><span class="n">Gamming</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">game</span> <span class="p">=</span> <span class="m">_</span><span class="n">game</span><span class="p">;</span>
    <span class="n">scene</span> <span class="p">=</span> <span class="n">SceneState</span><span class="p">.</span><span class="n">Waiting</span><span class="p">;</span>
    <span class="n">currentRound</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="n">currentTrial</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="n">score</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="n">onRefresh</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>          <span class="c1">// 需要重置游戏画面
</span><span class="c1"></span>    <span class="n">onEnterNextRound</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>   <span class="c1">// 需要重置 Ruler
</span><span class="c1"></span>  <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="n">NextRound</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">++</span><span class="n">currentRound</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currentRound</span> <span class="p">==</span> <span class="n">maxRound</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Reset</span><span class="p">(</span><span class="n">GameState</span><span class="p">.</span><span class="n">Win</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">onRefresh</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
      <span class="n">onEnterNextRound</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="n">NextTrial</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">++</span><span class="n">currentTrial</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">currentTrial</span> <span class="p">==</span> <span class="n">maxTrial</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">currentTrial</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
      <span class="p">++</span><span class="n">currentRound</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">currentRound</span> <span class="p">==</span> <span class="n">maxRound</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Reset</span><span class="p">(</span><span class="n">GameState</span><span class="p">.</span><span class="n">Win</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">onEnterNextRound</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">onRefresh</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">public</span> <span class="k">void</span> <span class="n">AddScore</span><span class="p">(</span><span class="kt">int</span> <span class="n">score</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">score</span> <span class="p">+=</span> <span class="n">score</span><span class="p">;</span>                      <span class="c1">// 击中得分
</span><span class="c1"></span>    <span class="n">onRefresh</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>  <span class="c1">// 通知场景控制器 更新游戏画面
</span><span class="c1"></span>  <span class="p">}</span>
  
  <span class="k">public</span> <span class="k">void</span> <span class="n">SubScore</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">score</span> <span class="p">-=</span> <span class="p">(</span><span class="n">currentRound</span> <span class="p">+</span> <span class="m">1</span><span class="p">)</span> <span class="p">*</span> <span class="m">10</span><span class="p">;</span>    <span class="c1">// 未击中扣分
</span><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="n">score</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Reset</span><span class="p">(</span><span class="n">GameState</span><span class="p">.</span><span class="n">Lose</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">onRefresh</span><span class="p">.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>裁判类不仅可以判断当前游戏状态，还可以设置当前游戏的难度和级别，即 Round 和 Trial，并且存取玩家的分数。</p>
<h3 id="适配器">适配器</h3>
<p>定义一个 <code>IActionManager</code> 动作管理适配器，用于实现不同的运动学模型：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">interface</span> <span class="n">ISceneController</span> <span class="p">{</span>
  <span class="k">void</span> <span class="n">LoadResources</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="n">IActionManager</span> <span class="p">{</span>
  <span class="k">void</span> <span class="n">SetAction</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">ufo</span><span class="p">);</span> <span class="c1">// 设置运动学模型
</span><span class="c1"></span><span class="p">}</span>
</code></pre></div><h4 id="物理模型">物理模型</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">PhysicActionManager</span> <span class="p">:</span> <span class="n">IActionManager</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">void</span> <span class="n">SetAction</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">ufo</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">rigidbody</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;();</span>
    <span class="kt">var</span> <span class="n">ufoModel</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>
    <span class="n">ufoModel</span><span class="p">.</span><span class="n">SetLocation</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="p">-</span><span class="m">10</span><span class="p">);</span>
    <span class="n">rigidbody</span><span class="p">.</span><span class="n">AddForce</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">GetSpeed</span><span class="p">(),</span> <span class="n">ForceMode</span><span class="p">.</span><span class="n">Impulse</span><span class="p">);</span> 
    <span class="n">rigidbody</span><span class="p">.</span><span class="n">useGravity</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="运动学变换模型">运动学变换模型</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">CCActionManager</span> <span class="p">:</span> <span class="n">IActionManager</span> <span class="p">{</span>
  <span class="k">private</span> <span class="k">class</span> <span class="nc">CCAction</span> <span class="p">:</span> <span class="n">MonoBehaviour</span> <span class="p">{</span>
    <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// 当飞碟被回收时，销毁该模型
</span><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">==</span> <span class="n">UFOFactory</span><span class="p">.</span><span class="n">invisible</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Destroy</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">MoveTowards</span><span class="p">(</span>
          <span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> 
          <span class="k">new</span> <span class="n">Vector3</span><span class="p">(-</span><span class="m">2f</span> <span class="p">+</span> <span class="n">model</span><span class="p">.</span><span class="n">GetId</span><span class="p">()</span> <span class="p">*</span> <span class="m">2f</span><span class="p">,</span> <span class="m">10f</span><span class="p">,</span> <span class="p">-</span><span class="m">2f</span><span class="p">),</span>
          <span class="m">5</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">public</span> <span class="k">void</span> <span class="n">SetAction</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">ufo</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">ufoModel</span> <span class="p">=</span> <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">UFOModel</span><span class="p">&gt;();</span>
    <span class="n">ufoModel</span><span class="p">.</span><span class="n">SetLocation</span><span class="p">(-</span><span class="m">4</span><span class="p">,</span> <span class="p">-</span><span class="m">2</span><span class="p">,</span> <span class="p">-</span><span class="m">10</span><span class="p">);</span>
    <span class="n">ufo</span><span class="p">.</span><span class="n">GetComponent</span><span class="p">&lt;</span><span class="n">Rigidbody</span><span class="p">&gt;().</span><span class="n">useGravity</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span> <span class="c1">// 预设 Rigidbody 取消重力设置
</span><span class="c1"></span>    <span class="n">ufo</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">CCAction</span><span class="p">&gt;();</span>                     <span class="c1">// 添加运动学（转换）运动
</span><span class="c1"></span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="运行效果">运行效果</h3>
<h4 id="运动学变换模型-1">运动学变换模型：</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110262231560.gif"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110262231560.gif, https://gitee.com/AdBean/img/raw/master/images/202110262231560.gif 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110262231560.gif 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110262231560.gif"
        title="preview" /></p>
<h4 id="物理学模型">物理学模型：</h4>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110262232789.gif"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110262232789.gif, https://gitee.com/AdBean/img/raw/master/images/202110262232789.gif 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110262232789.gif 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110262232789.gif"
        title="preview" /></p>
<h3 id="项目心得">项目心得：</h3>
<p>在本次项目之前，我接触过一些<strong>设计模式</strong>，比如观察者模式，但对于在游戏中如何实现工厂模式，我没有太多了解。在查阅了相关资料后，我才知道原来设计模式、面向对象编程，在游戏中是非常重要的，尤其使用工厂模式在编写大型游戏时，如果需要在多个地方创建对象，或者创建多个对象，工厂只需要负责提供创建、产生对象的接口即可，用户也只需要使用这个接口来创建对象，不需要暴露和了解其他的逻辑，比如对象是具体如何创建的。</p>
<p>但工厂模式也存在缺点，每个不同的对象都需要创建一个工厂，而这个对象却不需要创建太多时，项目中的类就大量地增加了。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-10-27</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/3d%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a>,&nbsp;<a href="/tags/%E4%BD%9C%E4%B8%9A/">作业</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/my-third-unity/" class="prev" rel="prev" title="3D游戏编程作业3-牧师与恶魔动作分离版"><i class="fas fa-angle-left fa-fw"></i>3D游戏编程作业3-牧师与恶魔动作分离版</a>
            <a href="/posts/my-sixth-unity/" class="next" rel="next" title="3D游戏编程作业6-智能巡逻兵">3D游戏编程作业6-智能巡逻兵<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://adbean.gitee.io/" target="_blank">Adbean</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
