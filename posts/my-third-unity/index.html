<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>3D游戏编程作业3-牧师与恶魔动作分离版 - Adbean&#39;s Blog</title><meta name="Description" content="Adbean&#39;s Blog"><meta property="og:title" content="3D游戏编程作业3-牧师与恶魔动作分离版" />
<meta property="og:description" content="牧师与魔鬼：动作分离版 阅读以下游戏脚本 Priests and Devils Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://ad-bean.github.io/posts/my-third-unity/" /><meta property="og:image" content="http://ad-bean.github.io/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-19T20:36:37+08:00" />
<meta property="article:modified_time" content="2021-10-19T20:36:37+08:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://ad-bean.github.io/logo.png"/>

<meta name="twitter:title" content="3D游戏编程作业3-牧师与恶魔动作分离版"/>
<meta name="twitter:description" content="牧师与魔鬼：动作分离版 阅读以下游戏脚本 Priests and Devils Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this"/>
<meta name="application-name" content="Adbean&#39;s Blog">
<meta name="apple-mobile-web-app-title" content="Adbean&#39;s Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/Owl.ico"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://ad-bean.github.io/posts/my-third-unity/" /><link rel="prev" href="http://ad-bean.github.io/posts/my-second-unity/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "3D游戏编程作业3-牧师与恶魔动作分离版",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/ad-bean.github.io\/posts\/my-third-unity\/"
        },"genre": "posts","keywords": "3D游戏编程, 作业","wordcount":  2565 ,
        "url": "http:\/\/ad-bean.github.io\/posts\/my-third-unity\/","datePublished": "2021-10-19T20:36:37+08:00","dateModified": "2021-10-19T20:36:37+08:00","publisher": {
            "@type": "Organization",
            "name": "Adbean"},"author": {
                "@type": "Person",
                "name": "Adbean"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('dark' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'dark' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Adbean&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/Owl.ico"
        data-srcset="/Owl.ico, /Owl.ico 1.5x, /Owl.ico 2x"
        data-sizes="auto"
        alt="/Owl.ico"
        title="/Owl.ico" />Adbean&#39;s Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> 主页 </a><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/posts/my-index/"> 索引 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Adbean&#39;s Blog"><img
        class="lazyload logo"
        src="/svg/loading.min.svg"
        data-src="/Owl.ico"
        data-srcset="/Owl.ico, /Owl.ico 1.5x, /Owl.ico 2x"
        data-sizes="auto"
        alt="/Owl.ico"
        title="/Owl.ico" />Adbean&#39;s Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">主页</a><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/posts/my-index/" title="">索引</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">3D游戏编程作业3-牧师与恶魔动作分离版</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://adbean.gitee.io/" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Adbean</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/%E4%BD%9C%E4%B8%9A/"><i class="far fa-folder fa-fw"></i>作业</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-10-19">2021-10-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2565 字&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#牧师与魔鬼动作分离版">牧师与魔鬼：动作分离版</a></li>
    <li><a href="#项目代码与项目视频演示">项目代码与项目视频演示</a></li>
    <li><a href="#项目文档">项目文档</a>
      <ul>
        <li><a href="#项目配置过程">项目配置过程</a></li>
        <li><a href="#游戏对象-objects-和预制资源-prefab">游戏对象 Objects 和预制资源 Prefab</a></li>
        <li><a href="#玩家动作表">玩家动作表</a></li>
        <li><a href="#职责设计与-mvc-框架">职责设计与 MVC 框架</a></li>
        <li><a href="#面向对象的游戏编程">面向对象的游戏编程</a></li>
        <li><a href="#核心代码与设计解读">核心代码与设计解读</a></li>
        <li><a href="#裁判">裁判</a></li>
        <li><a href="#运行效果">运行效果</a></li>
        <li><a href="#项目心得">项目心得</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="牧师与魔鬼动作分离版">牧师与魔鬼：动作分离版</h2>
<ul>
<li>阅读以下游戏脚本</li>
</ul>
<blockquote>
<p>Priests and Devils</p>
<p>Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this river, but there is only one boat and this boat can only carry two persons each time. And there must be one person steering the boat from one side to the other side. In the flash game, you can click on them to move them and click the go button to move the boat to the other direction. If the priests are out numbered by the devils on either side of the river, they get killed and the game is over. You can try it in many ways. Keep all priests alive! Good luck!</p>
</blockquote>
<p>程序需要满足的要求：</p>
<ul>
<li>设计一个裁判类，当游戏达到结束条件时，通知场景控制器游戏结束</li>
</ul>
<h2 id="项目代码与项目视频演示">项目代码与项目视频演示</h2>
<blockquote>
<p>博客地址：<a href="https://ad-bean.github.io/" target="_blank" rel="noopener noreffer">Github 博客</a></p>
<p>项目地址：<a href="https://gitee.com/adbean/Unity-3DGameProgramming" target="_blank" rel="noopener noreffer">Gitee 博客</a></p>
<p>作业 3：牧师与恶魔动作分离版展示：<a href="https://www.bilibili.com/video/BV1nu411f7CD/" target="_blank" rel="noopener noreffer">哔哩哔哩_bilibili</a></p>
</blockquote>
<h2 id="项目文档">项目文档</h2>
<h3 id="项目配置过程">项目配置过程</h3>
<p>将 <code>Assets</code> 文件夹下的文件全拖入新建项目后，点击新导入的 <code>Scene/</code> 中的 <code>PriestAndDevil</code> 场景，开始游戏后即可打开项目。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110071044566.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110071044566.png, https://gitee.com/AdBean/img/raw/master/images/202110071044566.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110071044566.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110071044566.png"
        title="image-20211007104426401" /></p>
<h3 id="游戏对象-objects-和预制资源-prefab">游戏对象 Objects 和预制资源 Prefab</h3>
<p>游戏涉及到的游戏对象（<code>GameObject</code>）：Priests、Devils、Boat、Coast、River ，使用了 Unity Asset 商店提供的免费素材与预制资源 Prefabs，也可以将其替换为长方体、球体等等。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062101303.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062101303.png, https://gitee.com/AdBean/img/raw/master/images/202110062101303.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062101303.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062101303.png"
        title="image-20211006210155268" /></p>
<table>
<thead>
<tr>
<th style="text-align:center">游戏对象</th>
<th style="text-align:center">预设对象</th>
<th style="text-align:center">游戏对象</th>
<th style="text-align:center">预设对象</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">牧师</td>
<td style="text-align:center"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062055932.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062055932.png, https://gitee.com/AdBean/img/raw/master/images/202110062055932.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062055932.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062055932.png"
        title="image-20211006205510888" /></td>
<td style="text-align:center">恶魔</td>
<td style="text-align:center"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062055814.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062055814.png, https://gitee.com/AdBean/img/raw/master/images/202110062055814.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062055814.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062055814.png"
        title="image-20211006205526759" /></td>
</tr>
<tr>
<td style="text-align:center">船</td>
<td style="text-align:center"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062054234.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062054234.png, https://gitee.com/AdBean/img/raw/master/images/202110062054234.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062054234.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062054234.png"
        title="image-20211006205440186" /></td>
<td style="text-align:center">河岸</td>
<td style="text-align:center"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062055625.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062055625.png, https://gitee.com/AdBean/img/raw/master/images/202110062055625.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062055625.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062055625.png"
        title="image-20211006205537590" /></td>
</tr>
<tr>
<td style="text-align:center">河流</td>
<td style="text-align:center"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110062055348.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110062055348.png, https://gitee.com/AdBean/img/raw/master/images/202110062055348.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110062055348.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110062055348.png"
        title="image-20211006205547298" /></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h3 id="玩家动作表">玩家动作表</h3>
<table>
<thead>
<tr>
<th style="text-align:center">玩家动作</th>
<th style="text-align:center">游戏对象具体行为</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">点击对象（牧师 / 恶魔）</td>
<td style="text-align:center">如果对象处于船上，则上岸</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">如果对象处于岸上，且船有空位，则上船，否则无动作</td>
</tr>
<tr>
<td style="text-align:center">点击船体</td>
<td style="text-align:center">船为空，无操作</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">船不为空，移动船体到对岸</td>
</tr>
</tbody>
</table>
<h3 id="职责设计与-mvc-框架">职责设计与 MVC 框架</h3>
<p>本次项目的 MVC 框架与上次项目一致，不再赘述，下面将介绍动作分离实现过程。</p>
<h3 id="面向对象的游戏编程">面向对象的游戏编程</h3>
<p>如果感觉到场记（<strong>控制器</strong>）管的事太多，不仅要处理用户交互事件，还要游戏对象加载、游戏规则实现、运动实现等等，而显得非常臃肿。</p>
<p>一个最直观的想法就是让更多的人（角色）来管理不同方面的工作。显然，这就是面向对象基于职责的思考，例如：用专用的对象来管理运动，专用的对象管理播放视频，专用的对象管理规则。就和踢足球一样，自己踢 5 人场，一个裁判就够了，如果是国际比赛，就需要主裁判、边裁判、电子裁判等角色通过消息协同来完成更为复杂的工作。</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110191939043.png"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110191939043.png, https://gitee.com/AdBean/img/raw/master/images/202110191939043.png 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110191939043.png 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110191939043.png"
        title="img" /></p>
<p>设计思路如下：</p>
<ul>
<li>通过<strong>门面模式</strong>（控制器模式）输出组合好的动作，提供给程序调用。
<ul>
<li>好处：动作组合变成动作模块内部的事务</li>
<li>这个门面就是 <code>CCActionManager</code></li>
</ul>
</li>
<li>通过<strong>组合模式</strong>实现动作组合，按组合模式设计方法
<ul>
<li>必须有一个抽象事物表示该类事物的共性，例如 <code>SSAction</code>，表示动作，不管是基本动作或是组合后动作</li>
<li>基本动作：用户设计的基本动作类。 例如：<code>CCMoveToAction</code></li>
<li>组合动作：由（基本或组合）动作组合的类。例如：<code>CCSequenceAction</code></li>
</ul>
</li>
<li>接口回调（函数回调）实现管理者与被管理者<strong>解耦</strong>
<ul>
<li>如组合对象实现一个事件抽象接口（<code>ISSCallback</code>），作为监听器（<code>listener</code>）监听子动作的事件</li>
<li>被组合对象使用监听器传递消息给管理者，至于管理者如何处理就是实现这个监听器的人说了算了</li>
<li>例如：每个学生做完作业通过邮箱发消息给学委，学委是谁，如何处理，学生就不用操心了</li>
</ul>
</li>
<li>通过<strong>模板</strong>方法，让使用者减少对动作管理过程细节的要求
<ul>
<li><code>SSActionManager</code> 作为 <code>CCActionManager</code> 基类</li>
</ul>
</li>
</ul>
<p>最终，程序员可以方便的定义动作并实现动作的自由组合，做到：</p>
<ul>
<li>程序更能适应需求变化</li>
<li>对象更容易被<strong>复用</strong></li>
<li>程序更易于维护</li>
</ul>
<h3 id="核心代码与设计解读">核心代码与设计解读</h3>
<h4 id="动作基类">动作基类</h4>
<p>使用抽象基类表示该类事物的共性，使用 <code>Action</code> 类表示动作：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">Action</span> <span class="p">:</span> <span class="n">ScriptableObject</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">enable</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>       <span class="c1">//
</span><span class="c1"></span>    <span class="k">public</span> <span class="kt">bool</span> <span class="n">destroy</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>     <span class="c1">//
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">IActionCallback</span> <span class="n">callback</span><span class="p">;</span> <span class="c1">// 回调实现消息通知，避免与动作管理直接依赖
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">GameObject</span> <span class="n">gameObject</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">Transform</span> <span class="n">transform</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// 动作逻辑
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">virtual</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">NotImplementedException</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>其中 <code> IActionCallback</code> 为回调接口，实现消息通知，避免与动作管理者直接依赖：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">interface</span> <span class="n">IActionCallback</span> <span class="p">{</span>
    <span class="k">void</span> <span class="n">ActionDone</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="简单动作实现">简单动作实现</h4>
<p><code>MoveToAction</code> 实现具体动作，将一个物体移动到目标位置，并通知任务完成：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System.Collections</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">MoveToAction</span> <span class="p">:</span> <span class="n">Action</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Vector3</span> <span class="n">destination</span><span class="p">;</span>
    <span class="k">public</span> <span class="kt">float</span> <span class="n">speed</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">MoveToAction</span> <span class="n">GetAction</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">gameObject</span><span class="p">,</span> <span class="n">IActionCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="n">Vector3</span> <span class="n">destination</span><span class="p">,</span> <span class="kt">float</span> <span class="n">speed</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MoveToAction</span> <span class="n">action</span> <span class="p">=</span> <span class="n">CreateInstance</span><span class="p">&lt;</span><span class="n">MoveToAction</span><span class="p">&gt;();</span>
      <span class="n">action</span><span class="p">.</span><span class="n">gameObject</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">;</span>           <span class="c1">// 设置需要进行直线运动的游戏对象
</span><span class="c1"></span>      <span class="n">action</span><span class="p">.</span><span class="n">transform</span> <span class="p">=</span> <span class="n">gameObject</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>  <span class="c1">//
</span><span class="c1"></span>      <span class="n">action</span><span class="p">.</span><span class="n">callback</span> <span class="p">=</span> <span class="n">callback</span><span class="p">;</span>               <span class="c1">// 回调
</span><span class="c1"></span>      <span class="n">action</span><span class="p">.</span><span class="n">destination</span> <span class="p">=</span> <span class="n">destination</span><span class="p">;</span>         <span class="c1">// 设置直线运动的终点
</span><span class="c1"></span>      <span class="n">action</span><span class="p">.</span><span class="n">speed</span> <span class="p">=</span> <span class="n">speed</span><span class="p">;</span>                     <span class="c1">// 设置直线运动的速度
</span><span class="c1"></span>      <span class="k">return</span> <span class="n">action</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">=</span> <span class="n">Vector3</span><span class="p">.</span><span class="n">MoveTowards</span><span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">speed</span> <span class="p">*</span> <span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span> <span class="p">==</span> <span class="n">destination</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">destroy</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="n">callback</span><span class="p">?.</span><span class="n">ActionDone</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="顺序动作组合类实现">顺序动作组合类实现</h4>
<p>实现一个动作组合序列，顺序播放动作，将上船、上岸的动作分解成：横向和纵向的直线运动，然后将顺序动作组合为一个动作， <code>SequenceAction</code> 类具体代码如下：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">SequenceAction</span> <span class="p">:</span> <span class="n">Action</span><span class="p">,</span> <span class="n">IActionCallback</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Action</span><span class="p">&gt;</span> <span class="n">sequence</span><span class="p">;</span>      <span class="c1">// 动作序列
</span><span class="c1"></span>    <span class="k">public</span> <span class="kt">int</span> <span class="n">repeat</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>             <span class="c1">// 重复次数
</span><span class="c1"></span>    <span class="k">public</span> <span class="kt">int</span> <span class="n">currentActionIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="c1">// 正在进行的动作
</span><span class="c1"></span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">SequenceAction</span> <span class="n">GetAction</span><span class="p">(</span><span class="n">IActionCallback</span> <span class="n">callback</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Action</span><span class="p">&gt;</span> <span class="n">sequence</span><span class="p">,</span> <span class="kt">int</span> <span class="n">repeat</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="kt">int</span> <span class="n">currentActionIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">SequenceAction</span> <span class="n">action</span> <span class="p">=</span> <span class="n">CreateInstance</span><span class="p">&lt;</span><span class="n">SequenceAction</span><span class="p">&gt;();</span>
      <span class="n">action</span><span class="p">.</span><span class="n">callback</span> <span class="p">=</span> <span class="n">callback</span><span class="p">;</span>
      <span class="n">action</span><span class="p">.</span><span class="n">sequence</span> <span class="p">=</span> <span class="n">sequence</span><span class="p">;</span>
      <span class="n">action</span><span class="p">.</span><span class="n">repeat</span> <span class="p">=</span> <span class="n">repeat</span><span class="p">;</span>
      <span class="n">action</span><span class="p">.</span><span class="n">currentActionIndex</span> <span class="p">=</span> <span class="n">currentActionIndex</span><span class="p">;</span>
      <span class="k">return</span> <span class="n">action</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// 执行动作前，为每个动作注入当前动作游戏对象，并将自己作为动作事件的接收者
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="n">Start</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="n">Action</span> <span class="n">action</span> <span class="k">in</span> <span class="n">sequence</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">action</span><span class="p">.</span><span class="n">callback</span> <span class="p">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="n">action</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sequence</span><span class="p">.</span><span class="n">Count</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">currentActionIndex</span> <span class="p">&lt;</span> <span class="n">sequence</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">sequence</span><span class="p">[</span><span class="n">currentActionIndex</span><span class="p">].</span><span class="n">Update</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">ActionDone</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">action</span><span class="p">.</span><span class="n">destroy</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
      <span class="n">currentActionIndex</span><span class="p">++;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">currentActionIndex</span> <span class="p">&gt;=</span> <span class="n">sequence</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentActionIndex</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">repeat</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">repeat</span><span class="p">--;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">repeat</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">destroy</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
          <span class="n">callback</span><span class="p">?.</span><span class="n">ActionDone</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>     <span class="c1">// 动作完毕，执行回调
</span><span class="c1"></span>        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// `OnDestory` 如果自己被注销，应该释放自己管理的动作。
</span><span class="c1"></span>    <span class="k">void</span> <span class="n">OnDestroy</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="n">Action</span> <span class="n">action</span> <span class="k">in</span> <span class="n">sequence</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Destroy</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="动作管理">动作管理</h4>
<p>动作对象管理器的基类 <code>GameActionManager</code>，实现了所有动作的基本管理，利用 <code>MonoBehaiviour</code> 字典管理一个动作集合，实现动作的创建、完成和回收。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">ActionManager</span> <span class="p">:</span> <span class="n">MonoBehaviour</span><span class="p">,</span> <span class="n">IActionCallback</span> <span class="p">{</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;</span> <span class="n">actions</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;();</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Action</span><span class="p">&gt;</span> <span class="n">waitToAdd</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Action</span><span class="p">&gt;();</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">waitToDelete</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;();</span>

    <span class="k">protected</span> <span class="k">void</span> <span class="n">Update</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="n">Action</span> <span class="n">action</span> <span class="k">in</span> <span class="n">waitToAdd</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">actions</span><span class="p">[</span><span class="n">action</span><span class="p">.</span><span class="n">GetInstanceID</span><span class="p">()]</span> <span class="p">=</span> <span class="n">action</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">waitToAdd</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
      <span class="k">foreach</span> <span class="p">(</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">Action</span><span class="p">&gt;</span> <span class="n">kv</span> <span class="k">in</span> <span class="n">actions</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Action</span> <span class="n">action</span> <span class="p">=</span> <span class="n">kv</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">destroy</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">waitToDelete</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">GetInstanceID</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">action</span><span class="p">.</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">action</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">foreach</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="k">in</span> <span class="n">waitToDelete</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Action</span> <span class="n">action</span> <span class="p">=</span> <span class="n">actions</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
        <span class="n">actions</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
        <span class="n">Destroy</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">waitToDelete</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">AddAction</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">waitToAdd</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
      <span class="n">action</span><span class="p">.</span><span class="n">Start</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">ActionDone</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h4 id="使用动作组合">使用动作组合</h4>
<p>使用动作管理类实现具体的动作管理，如 <code>MoveSprite</code> 和 <code>MoveBoat</code>。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">class</span> <span class="nc">GameActionManager</span> <span class="p">:</span> <span class="n">ActionManager</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="n">MoveBoat</span><span class="p">(</span><span class="n">BoatController</span> <span class="n">boat</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">MoveToAction</span> <span class="n">action</span> <span class="p">=</span> <span class="n">MoveToAction</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="n">boat</span><span class="p">.</span><span class="n">gameObject</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="n">boat</span><span class="p">.</span><span class="n">GetDestination</span><span class="p">(),</span> <span class="m">20</span><span class="p">);</span>
      <span class="n">AddAction</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="n">MoveSprite</span><span class="p">(</span><span class="n">SpriteController</span> <span class="n">sprite</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">Vector3</span> <span class="n">destination</span> <span class="p">=</span> <span class="n">sprite</span><span class="p">.</span><span class="n">GetDestination</span><span class="p">();</span>
      <span class="n">GameObject</span> <span class="n">gameObject</span> <span class="p">=</span> <span class="n">sprite</span><span class="p">.</span><span class="n">gameObject</span><span class="p">;</span>
      <span class="n">Vector3</span> <span class="n">currentPosition</span> <span class="p">=</span> <span class="n">sprite</span><span class="p">.</span><span class="n">transform</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
      <span class="n">Vector3</span> <span class="n">pivotPosition</span> <span class="p">=</span> <span class="n">currentPosition</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">destination</span><span class="p">.</span><span class="n">y</span> <span class="p">&gt;</span> <span class="n">currentPosition</span><span class="p">.</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pivotPosition</span><span class="p">.</span><span class="n">y</span> <span class="p">=</span> <span class="n">destination</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">pivotPosition</span><span class="p">.</span><span class="n">x</span> <span class="p">=</span> <span class="n">destination</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">Action</span> <span class="n">action1</span> <span class="p">=</span> <span class="n">MoveToAction</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="n">gameObject</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">pivotPosition</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
      <span class="n">Action</span> <span class="n">action2</span> <span class="p">=</span> <span class="n">MoveToAction</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="n">gameObject</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="m">20</span><span class="p">);</span>
      <span class="n">SequenceAction</span> <span class="n">action</span> <span class="p">=</span> <span class="n">SequenceAction</span><span class="p">.</span><span class="n">GetAction</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Action</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">action1</span><span class="p">,</span> <span class="n">action2</span> <span class="p">});</span>
      <span class="n">AddAction</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="裁判">裁判</h3>
<p>裁判类使用 <code>EventHandler</code> 沟通各个场景，一旦游戏状态发生改变，使用 <code>onChange?.Invoke(this, EventArgs.Empty)</code> 通知场景控制器游戏结束。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-csharp" data-lang="csharp"><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">UnityEngine</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">PriestsAndDevils</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">enum</span> <span class="n">GameStatus</span> <span class="p">{</span> <span class="n">GAMING</span><span class="p">,</span> <span class="n">WIN</span><span class="p">,</span> <span class="n">LOSE</span> <span class="p">}</span>

  <span class="k">public</span> <span class="k">class</span> <span class="nc">Game</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">GameStatus</span> <span class="n">status</span> <span class="p">=</span> <span class="n">GameStatus</span><span class="p">.</span><span class="n">GAMING</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Boat</span> <span class="n">boat</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Coast</span> <span class="n">leftCoast</span><span class="p">,</span> <span class="n">rightCoast</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">event</span> <span class="n">EventHandler</span> <span class="n">onChange</span><span class="p">;</span> <span class="c1">// 用于通知场景控制器游戏的胜负
</span><span class="c1"></span>    <span class="k">public</span> <span class="n">Game</span><span class="p">(</span><span class="n">Boat</span> <span class="n">boat</span><span class="p">,</span> <span class="n">Coast</span> <span class="n">leftCoast</span><span class="p">,</span> <span class="n">Coast</span> <span class="n">rightCoast</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="n">boat</span> <span class="p">=</span> <span class="n">boat</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="n">leftCoast</span> <span class="p">=</span> <span class="n">leftCoast</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="n">rightCoast</span> <span class="p">=</span> <span class="n">rightCoast</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// It determines whether the player wins the game.
</span><span class="c1"></span>    <span class="k">public</span> <span class="k">void</span> <span class="n">CheckGameStatus</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">status</span> <span class="p">=</span> <span class="n">GameStatus</span><span class="p">.</span><span class="n">GAMING</span><span class="p">;</span>
      <span class="kt">int</span> <span class="n">leftPriests</span> <span class="p">=</span> <span class="n">leftCoast</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">0</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">leftDevils</span> <span class="p">=</span> <span class="n">leftCoast</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">1</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">rightPriests</span> <span class="p">=</span> <span class="n">rightCoast</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">0</span><span class="p">];</span>
      <span class="kt">int</span> <span class="n">rightDevils</span> <span class="p">=</span> <span class="n">rightCoast</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">1</span><span class="p">];</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">leftPriests</span> <span class="p">+</span> <span class="n">leftDevils</span> <span class="p">==</span> <span class="m">6</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">status</span> <span class="p">=</span> <span class="n">GameStatus</span><span class="p">.</span><span class="n">WIN</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">boat</span><span class="p">.</span><span class="n">location</span> <span class="p">==</span> <span class="n">Location</span><span class="p">.</span><span class="n">Right</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">rightPriests</span> <span class="p">+=</span> <span class="n">boat</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">0</span><span class="p">];</span>
        <span class="n">rightDevils</span> <span class="p">+=</span> <span class="n">boat</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">1</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">leftPriests</span> <span class="p">+=</span> <span class="n">boat</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">0</span><span class="p">];</span>
        <span class="n">leftDevils</span> <span class="p">+=</span> <span class="n">boat</span><span class="p">.</span><span class="n">GetCharacterAmount</span><span class="p">()[</span><span class="m">1</span><span class="p">];</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">((</span><span class="n">rightPriests</span> <span class="p">&lt;</span> <span class="n">rightDevils</span> <span class="p">&amp;&amp;</span> <span class="n">rightPriests</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">||</span> <span class="p">(</span><span class="n">leftPriests</span> <span class="p">&lt;</span> <span class="n">leftDevils</span> <span class="p">&amp;&amp;</span> <span class="n">leftPriests</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">status</span> <span class="p">=</span> <span class="n">GameStatus</span><span class="p">.</span><span class="n">LOSE</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="c1">// 通知场景控制器
</span><span class="c1"></span>      <span class="n">onChange</span><span class="p">?.</span><span class="n">Invoke</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">EventArgs</span><span class="p">.</span><span class="n">Empty</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="运行效果">运行效果</h3>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110192007449.gif"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110192007449.gif, https://gitee.com/AdBean/img/raw/master/images/202110192007449.gif 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110192007449.gif 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110192007449.gif"
        title="preview" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://gitee.com/AdBean/img/raw/master/images/202110192008106.gif"
        data-srcset="https://gitee.com/AdBean/img/raw/master/images/202110192008106.gif, https://gitee.com/AdBean/img/raw/master/images/202110192008106.gif 1.5x, https://gitee.com/AdBean/img/raw/master/images/202110192008106.gif 2x"
        data-sizes="auto"
        alt="https://gitee.com/AdBean/img/raw/master/images/202110192008106.gif"
        title="preview" /></p>
<h3 id="项目心得">项目心得</h3>
<p>本次项目由于跟上一次项目差不太多，主要是使用了面向对象的游戏编程设计，加入了裁判类和动作管理，使得整个游戏项目的结构更加清晰，编程逻辑也更加明了，同时 BUG 也更少了（？</p>
<p>但对于 C# ，还可以使用 <code>Delegate</code> 委托方法实现组合，同样也是面向对象，利用委托和观察者模式，保证消息发送者的安全性和封装性的同时，也可以实现动作的组合。</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2021-10-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/3d%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B/">3D游戏编程</a>,&nbsp;<a href="/tags/%E4%BD%9C%E4%B8%9A/">作业</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/my-second-unity/" class="prev" rel="prev" title="3D游戏编程作业2-牧师与恶魔"><i class="fas fa-angle-left fa-fw"></i>3D游戏编程作业2-牧师与恶魔</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020 - 2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://adbean.gitee.io/" target="_blank">Adbean</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
